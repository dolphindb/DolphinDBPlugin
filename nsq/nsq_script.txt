login("admin", "123456")
loadPlugin("/home/dolphindb/Documents/dolphindb0/src/DolphinDBPlugin/nsq/build/PluginNsq.txt");
go

share streamTable(
    array(SYMBOL, 0) as ExchangeId,
    array(SYMBOL, 0) as InstrumentId,
    array(DOUBLE, 0) as LastPrice,
    array(DOUBLE, 0) as PreClosePrice,
    array(DOUBLE, 0) as OpenPrice,
    array(DOUBLE, 0) as HighPrice,
    array(DOUBLE, 0) as LowPrice,
    array(DOUBLE, 0) as ClosePrice,
    array(DOUBLE, 0) as UpperLimitPrice,
    array(DOUBLE, 0) as LowerLimitPrice,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as UpdateTime,
    array(LONG, 0) as TradeVolume,
    array(DOUBLE, 0) as TradeBalance,
    array(DOUBLE, 0) as AveragePrice,
    array(DOUBLE, 0) as BidPrice1,
    array(DOUBLE, 0) as BidPrice2,
    array(DOUBLE, 0) as BidPrice3,
    array(DOUBLE, 0) as BidPrice4,
    array(DOUBLE, 0) as BidPrice5,
    array(DOUBLE, 0) as BidPrice6,
    array(DOUBLE, 0) as BidPrice7,
    array(DOUBLE, 0) as BidPrice8,
    array(DOUBLE, 0) as BidPrice9,
    array(DOUBLE, 0) as BidPrice10,
    array(DOUBLE, 0) as AskPrice1,
    array(DOUBLE, 0) as AskPrice2,
    array(DOUBLE, 0) as AskPrice3,
    array(DOUBLE, 0) as AskPrice4,
    array(DOUBLE, 0) as AskPrice5,
    array(DOUBLE, 0) as AskPrice6,
    array(DOUBLE, 0) as AskPrice7,
    array(DOUBLE, 0) as AskPrice8,
    array(DOUBLE, 0) as AskPrice9,
    array(DOUBLE, 0) as AskPrice10,
    array(LONG, 0) as BidVolume1,
    array(LONG, 0) as BidVolume2,
    array(LONG, 0) as BidVolume3,
    array(LONG, 0) as BidVolume4,
    array(LONG, 0) as BidVolume5,
    array(LONG, 0) as BidVolume6,
    array(LONG, 0) as BidVolume7,
    array(LONG, 0) as BidVolume8,
    array(LONG, 0) as BidVolume9,
    array(LONG, 0) as BidVolume10,
    array(LONG, 0) as AskVolume1,
    array(LONG, 0) as AskVolume2,
    array(LONG, 0) as AskVolume3,
    array(LONG, 0) as AskVolume4,
    array(LONG, 0) as AskVolume5,
    array(LONG, 0) as AskVolume6,
    array(LONG, 0) as AskVolume7,
    array(LONG, 0) as AskVolume8,
    array(LONG, 0) as AskVolume9,
    array(LONG, 0) as AskVolume10,
    array(LONG, 0) as TradesNum,
    array(CHAR, 0) as InstrumentTradeStatus,
    array(LONG, 0) as TotalBidVolume,
    array(LONG, 0) as TotalAskVolume,
    array(DOUBLE, 0) as MaBidPrice,
    array(DOUBLE, 0) as MaAskPrice,
    array(DOUBLE, 0) as MaBondBidPrice,
    array(DOUBLE, 0) as MaBondAskPrice,
    array(DOUBLE, 0) as YieldToMaturity,
    array(DOUBLE, 0) as IOPV,
    array(INT, 0) as EtfBuycount,
    array(INT, 0) as EtfSellCount,
    array(LONG, 0) as EtfBuyVolume,
    array(DOUBLE, 0) as EtfBuyBalance,
    array(LONG, 0) as EtfSellVolume,
    array(DOUBLE, 0) as EtfSellBalance,
    array(LONG, 0) as TotalWarrantExecVolume,
    array(DOUBLE, 0) as WarrantLowerPrice,
    array(DOUBLE, 0) as WarrantUpperPrice,
    array(INT, 0) as CancelBuyNum,
    array(INT, 0) as CancelSellNum,
    array(LONG, 0) as CancelBuyVolume,
    array(LONG, 0) as CancelSellVolume,
    array(DOUBLE, 0) as CancelBuyValue,
    array(DOUBLE, 0) as CancelSellValue,
    array(INT, 0) as TotalBuyNum,
    array(INT, 0) as TotalSellNum,
    array(INT, 0) as DurationAfterBuy,
    array(INT, 0) as DurationAfterSell,
    array(INT, 0) as BidOrdersNum,
    array(INT, 0) as AskOrdersNum,
    array(DOUBLE, 0) as PreIOPV
) as snapshot_sh;

share streamTable(
    array(SYMBOL, 0) as ExchangeId,
    array(SYMBOL, 0) as InstrumentId,
    array(DOUBLE, 0) as LastPrice,
    array(DOUBLE, 0) as PreClosePrice,
    array(DOUBLE, 0) as OpenPrice,
    array(DOUBLE, 0) as HighPrice,
    array(DOUBLE, 0) as LowPrice,
    array(DOUBLE, 0) as ClosePrice,
    array(DOUBLE, 0) as UpperLimitPrice,
    array(DOUBLE, 0) as LowerLimitPrice,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as UpdateTime,
    array(LONG, 0) as TradeVolume,
    array(DOUBLE, 0) as TradeBalance,
    array(DOUBLE, 0) as AveragePrice,
    array(DOUBLE, 0) as BidPrice1,
    array(DOUBLE, 0) as BidPrice2,
    array(DOUBLE, 0) as BidPrice3,
    array(DOUBLE, 0) as BidPrice4,
    array(DOUBLE, 0) as BidPrice5,
    array(DOUBLE, 0) as BidPrice6,
    array(DOUBLE, 0) as BidPrice7,
    array(DOUBLE, 0) as BidPrice8,
    array(DOUBLE, 0) as BidPrice9,
    array(DOUBLE, 0) as BidPrice10,
    array(DOUBLE, 0) as AskPrice1,
    array(DOUBLE, 0) as AskPrice2,
    array(DOUBLE, 0) as AskPrice3,
    array(DOUBLE, 0) as AskPrice4,
    array(DOUBLE, 0) as AskPrice5,
    array(DOUBLE, 0) as AskPrice6,
    array(DOUBLE, 0) as AskPrice7,
    array(DOUBLE, 0) as AskPrice8,
    array(DOUBLE, 0) as AskPrice9,
    array(DOUBLE, 0) as AskPrice10,
    array(LONG, 0) as BidVolume1,
    array(LONG, 0) as BidVolume2,
    array(LONG, 0) as BidVolume3,
    array(LONG, 0) as BidVolume4,
    array(LONG, 0) as BidVolume5,
    array(LONG, 0) as BidVolume6,
    array(LONG, 0) as BidVolume7,
    array(LONG, 0) as BidVolume8,
    array(LONG, 0) as BidVolume9,
    array(LONG, 0) as BidVolume10,
    array(LONG, 0) as AskVolume1,
    array(LONG, 0) as AskVolume2,
    array(LONG, 0) as AskVolume3,
    array(LONG, 0) as AskVolume4,
    array(LONG, 0) as AskVolume5,
    array(LONG, 0) as AskVolume6,
    array(LONG, 0) as AskVolume7,
    array(LONG, 0) as AskVolume8,
    array(LONG, 0) as AskVolume9,
    array(LONG, 0) as AskVolume10,
    array(LONG, 0) as TradesNum,
    array(CHAR, 0) as InstrumentTradeStatus,
    array(LONG, 0) as TotalBidVolume,
    array(LONG, 0) as TotalAskVolume,
    array(DOUBLE, 0) as MaBidPrice,
    array(DOUBLE, 0) as MaAskPrice,
    array(DOUBLE, 0) as MaBondBidPrice,
    array(DOUBLE, 0) as MaBondAskPrice,
    array(DOUBLE, 0) as YieldToMaturity,
    array(DOUBLE, 0) as IOPV,
    array(INT, 0) as EtfBuycount,
    array(INT, 0) as EtfSellCount,
    array(LONG, 0) as EtfBuyVolume,
    array(DOUBLE, 0) as EtfBuyBalance,
    array(LONG, 0) as EtfSellVolume,
    array(DOUBLE, 0) as EtfSellBalance,
    array(LONG, 0) as TotalWarrantExecVolume,
    array(DOUBLE, 0) as WarrantLowerPrice,
    array(DOUBLE, 0) as WarrantUpperPrice,
    array(INT, 0) as CancelBuyNum,
    array(INT, 0) as CancelSellNum,
    array(LONG, 0) as CancelBuyVolume,
    array(LONG, 0) as CancelSellVolume,
    array(DOUBLE, 0) as CancelBuyValue,
    array(DOUBLE, 0) as CancelSellValue,
    array(INT, 0) as TotalBuyNum,
    array(INT, 0) as TotalSellNum,
    array(INT, 0) as DurationAfterBuy,
    array(INT, 0) as DurationAfterSell,
    array(INT, 0) as BidOrdersNum,
    array(INT, 0) as AskOrdersNum,
    array(DOUBLE, 0) as PreIOPV
) as snapshot_sz;

share table(
    array(SYMBOL, 0) as ExchangeId,
    array(SYMBOL, 0) as InstrumentId,
    array(DOUBLE, 0) as LastPrice,
    array(DOUBLE, 0) as PreClosePrice,
    array(DOUBLE, 0) as OpenPrice,
    array(DOUBLE, 0) as HighPrice,
    array(DOUBLE, 0) as LowPrice,
    array(DOUBLE, 0) as ClosePrice,
    array(DOUBLE, 0) as UpperLimitPrice,
    array(DOUBLE, 0) as LowerLimitPrice,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as UpdateTime,
    array(LONG, 0) as TradeVolume,
    array(DOUBLE, 0) as TradeBalance,
    array(DOUBLE, 0) as AveragePrice,
    array(DOUBLE, 0) as BidPrice1,
    array(DOUBLE, 0) as BidPrice2,
    array(DOUBLE, 0) as BidPrice3,
    array(DOUBLE, 0) as BidPrice4,
    array(DOUBLE, 0) as BidPrice5,
    array(DOUBLE, 0) as BidPrice6,
    array(DOUBLE, 0) as BidPrice7,
    array(DOUBLE, 0) as BidPrice8,
    array(DOUBLE, 0) as BidPrice9,
    array(DOUBLE, 0) as BidPrice10,
    array(DOUBLE, 0) as AskPrice1,
    array(DOUBLE, 0) as AskPrice2,
    array(DOUBLE, 0) as AskPrice3,
    array(DOUBLE, 0) as AskPrice4,
    array(DOUBLE, 0) as AskPrice5,
    array(DOUBLE, 0) as AskPrice6,
    array(DOUBLE, 0) as AskPrice7,
    array(DOUBLE, 0) as AskPrice8,
    array(DOUBLE, 0) as AskPrice9,
    array(DOUBLE, 0) as AskPrice10,
    array(LONG, 0) as BidVolume1,
    array(LONG, 0) as BidVolume2,
    array(LONG, 0) as BidVolume3,
    array(LONG, 0) as BidVolume4,
    array(LONG, 0) as BidVolume5,
    array(LONG, 0) as BidVolume6,
    array(LONG, 0) as BidVolume7,
    array(LONG, 0) as BidVolume8,
    array(LONG, 0) as BidVolume9,
    array(LONG, 0) as BidVolume10,
    array(LONG, 0) as AskVolume1,
    array(LONG, 0) as AskVolume2,
    array(LONG, 0) as AskVolume3,
    array(LONG, 0) as AskVolume4,
    array(LONG, 0) as AskVolume5,
    array(LONG, 0) as AskVolume6,
    array(LONG, 0) as AskVolume7,
    array(LONG, 0) as AskVolume8,
    array(LONG, 0) as AskVolume9,
    array(LONG, 0) as AskVolume10,
    array(LONG, 0) as TradesNum,
    array(CHAR, 0) as InstrumentTradeStatus,
    array(LONG, 0) as TotalBidVolume,
    array(LONG, 0) as TotalAskVolume,
    array(DOUBLE, 0) as MaBidPrice,
    array(DOUBLE, 0) as MaAskPrice,
    array(DOUBLE, 0) as MaBondBidPrice,
    array(DOUBLE, 0) as MaBondAskPrice,
    array(DOUBLE, 0) as YieldToMaturity,
    array(DOUBLE, 0) as IOPV,
    array(INT, 0) as EtfBuycount,
    array(INT, 0) as EtfSellCount,
    array(LONG, 0) as EtfBuyVolume,
    array(DOUBLE, 0) as EtfBuyBalance,
    array(LONG, 0) as EtfSellVolume,
    array(DOUBLE, 0) as EtfSellBalance,
    array(LONG, 0) as TotalWarrantExecVolume,
    array(DOUBLE, 0) as WarrantLowerPrice,
    array(DOUBLE, 0) as WarrantUpperPrice,
    array(INT, 0) as CancelBuyNum,
    array(INT, 0) as CancelSellNum,
    array(LONG, 0) as CancelBuyVolume,
    array(LONG, 0) as CancelSellVolume,
    array(DOUBLE, 0) as CancelBuyValue,
    array(DOUBLE, 0) as CancelSellValue,
    array(INT, 0) as TotalBuyNum,
    array(INT, 0) as TotalSellNum,
    array(INT, 0) as DurationAfterBuy,
    array(INT, 0) as DurationAfterSell,
    array(INT, 0) as BidOrdersNum,
    array(INT, 0) as AskOrdersNum,
    array(DOUBLE, 0) as PreIOPV
) as snapshot;

share streamTable(
    array(SYMBOL, 0) as ExchangeID,
    array(SYMBOL, 0) as InstrumentID,
    array(INT, 0) as TransFlag,
    array(LONG, 0) as SeqNo,
    array(INT, 0) as ChannelNo,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as TransactTime,
    array(DOUBLE, 0) as TrdPrice,
    array(LONG, 0) as TrdVolume,
    array(DOUBLE, 0) as TrdMoney,
    array(LONG, 0) as TrdBuyNo,
    array(LONG, 0) as TrdSellNo,
    array(CHAR, 0) as TrdBSFlag,
    array(LONG, 0) as BizIndex
) as trade_sh;

share streamTable(
    array(SYMBOL, 0) as ExchangeID,
    array(SYMBOL, 0) as InstrumentID,
    array(INT, 0) as TransFlag,
    array(LONG, 0) as SeqNo,
    array(INT, 0) as ChannelNo,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as TransactTime,
    array(DOUBLE, 0) as TrdPrice,
    array(LONG, 0) as TrdVolume,
    array(DOUBLE, 0) as TrdMoney,
    array(LONG, 0) as TrdBuyNo,
    array(LONG, 0) as TrdSellNo,
    array(CHAR, 0) as TrdBSFlag,
    array(LONG, 0) as BizIndex
) as trade_sz;

share streamTable(
    array(SYMBOL, 0) as ExchangeID,
    array(SYMBOL, 0) as InstrumentID,
    array(INT, 0) as TransFlag,
    array(LONG, 0) as SeqNo,
    array(INT, 0) as ChannelNo,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as TransactTime,
    array(DOUBLE, 0) as OrdPrice,
    array(LONG, 0) as OrdVolume,
    array(CHAR, 0) as OrdSide,
    array(CHAR, 0) as OrdType,
    array(LONG, 0) as OrdNo,
    array(LONG, 0) as BizIndex
) as orders_sh;

share streamTable(
    array(SYMBOL, 0) as ExchangeID,
    array(SYMBOL, 0) as InstrumentID,
    array(INT, 0) as TransFlag,
    array(LONG, 0) as SeqNo,
    array(INT, 0) as ChannelNo,
    array(DATE, 0) as TradeDate,
    array(TIME, 0) as TransactTime,
    array(DOUBLE, 0) as OrdPrice,
    array(LONG, 0) as OrdVolume,
    array(CHAR, 0) as OrdSide,
    array(CHAR, 0) as OrdType,
    array(LONG, 0) as OrdNo,
    array(LONG, 0) as BizIndex
) as orders_sz;

nsq::connect("/home/dolphindb/Documents/dolphindb0/src/DolphinDBPlugin/nsq/sdk_config.ini");
nsq::subscribe(`snapshot, `sh, snapshot_sh);
//// 取消订阅
nsq::unsubscribe(`snapshot, `sh)
//// 更换订阅
nsq::subscribe(`snapshot, `sh, snapshot_sh);
nsq::subscribe(`snapshot, `sz, snapshot_sz);
nsq::subscribe(`trade, `sh, trade_sh);
nsq::subscribe(`trade, `sz, trade_sz);
nsq::subscribe(`orders, `sh, orders_sh);
nsq::subscribe(`orders, `sz, orders_sz);

// 获取每个订阅的状态
status = nsq::getSubscriptionStatus();
select * from status;

//nsq::close();

select count(*)  from snapshot_sh;
select count(*) from orders_sh;
select * from snapshot_sh limit 100;

//nsq::unsubscribe(`snapshot, `sh)
